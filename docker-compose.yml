services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    environment:
      # Caminho do banco de dados dentro do container
      - DB_PATH=/usr/src/app/data/belafarma.db
    volumes:
      # Monta diretório de dados (não apenas o arquivo)
      # Isso garante que o SQLite possa criar arquivos -wal e -shm
      - ./data:/usr/src/app/data
    restart: unless-stopped
    # A porta 3001 não precisa ser exposta ao host, 
    # pois o Nginx se comunicará com ele pela rede interna do Docker.

  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    ports:
      - "80:80" # Expõe a porta 80 do Nginx para o mundo exterior
    depends_on:
      - backend # Garante que o backend inicie antes do frontend
    restart: unless-stopped